# The figure highlights the five major volatile compounds.
library(dplyr)

data<- Data_cluster_absolute
# Remove Genotype column for calculation
voc_data <- data %>%
  select(-genotypes) %>%
  relocate(Cluster)  # Make sure Cluster is the first column

# Calculate mean for each VOC compound within each cluster
cluster_means <- voc_data %>%
  group_by(Cluster) %>%
  summarise(across(everything(), mean, na.rm = TRUE))

# View the result
print(cluster_means)
# Function to get top 3 VOCs per cluster
top_vocs_per_cluster <- function(cluster_row) {
  cluster_number <- cluster_row["Cluster"]
  voc_values <- cluster_row[-1]  # exclude 'Cluster' column
  top_vocs <- sort(voc_values, decreasing = TRUE)[1:5]
  data.frame(
    Cluster = cluster_number,
    Compound = names(top_vocs),
    Mean_Value = as.numeric(top_vocs)
  )
}

# Apply the function to each cluster row
top_compounds <- do.call(rbind, apply(cluster_means, 1, top_vocs_per_cluster))

# View result
print(top_compounds)
install.packages("ggsci")

library(ggsci)
library(ggplot2)

# Open new plotting window (Windows example)
windows()

# Plot
ggplot(top_compounds, aes(x = reorder(Compound, -Mean_Value), y = Mean_Value, fill = as.factor(Cluster))) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.5), width = 0.5) +  # Narrower bars
  facet_wrap(~ Cluster, scales = "free") +
  labs(title = "Top 5 VOCs per Mentha Cluster", x = "VOC Compound", y = "Mean (Absolute quantity)") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 12, face = "bold")  # Bigger & bold x-axis text
  ) +
  scale_fill_manual(values = c(
    "6" = "#B00000",  # deep red
    "8" = "#E66100",  # reddish orange
    "3" = "#F6C800",  # yellow
    "4" = "#A6D200",  # yellow-green
    "7" = "#00B9E3",  # cyan
    "1" = "#1E78B4",  # blue
    "5" = "#6829C2",  # purple
    "2" = "#F3569A"  # pink
  )
  )


